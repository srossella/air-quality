(()=>{let e,t="",o="";const n=()=>{document.getElementById("error").style.display="none",document.getElementById("result-data").style.display="none";let e=document.getElementsByClassName("values");for(let t=0;t<e.length;t++)e[t].textContent=""},l=e=>{if("error"===e.status)return;document.getElementById("result-data").style.display="block";let t=e.data.aqi;const o=e.data.city.name;document.getElementById("result-city").textContent=o,t>0?document.getElementById("aqi").textContent=t:(document.getElementById("aqi").textContent="N/A",document.getElementById("color").style.display="none");const n=["pm25","pm10","no2","o3"];for(let t of n)e.data.iaqi.hasOwnProperty(t)?document.getElementById(t).textContent=e.data.iaqi[t].v:document.getElementById(t).textContent="N/A";let l,a,c;return t<=50&&t>=0?(l="Good",a="green",c="white"):t>50&&t<=100?(l="Moderate",a="yellow",c="black"):t>100&&t<=150?(l="Unhealthy for Sensitive Groups",a="orange",c="black"):t>150&&t<=200?(l="Unhealthy",a="red",c="white"):t>200&&t<=300?(l="Very Unhealthy",a="purple",c="white"):t>300?(l="Hazardous",a="maroon",c="white"):document.getElementById("color").style.display="none",document.getElementById("color").textContent=l,document.getElementById("color").style.backgroundColor=a,document.getElementById("color").style.color=c,e},a=t=>{let o=t.data.city.geo[0],n=t.data.city.geo[1];null!=e&&e.remove(),e=L.map("map").setView([o,n],12),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'}).addTo(e),L.marker([o,n]).addTo(e)},c=()=>(n(),(async()=>{const e=`/.netlify/functions/fetch_air_input?input=${document.getElementById("input-city").value}`;try{const t=await fetch(e);if(t.ok){const e=await t.json();return console.log(e),"ok"!=e.status&&(console.log("Error with city name!"),document.getElementById("error").style.display="block",document.getElementById("error").textContent="City not found",console.log(e)),e}}catch(e){console.log(e),document.getElementById("error").style.display="block",document.getElementById("error").textContent="Connection issue. Please try again."}})().then((e=>l(e))).then((e=>a(e))),!1),r=e=>{const n=e.coords;t=n.latitude,o=n.longitude,console.log(`Latitude : ${t}`),console.log(`Longitude: ${o}`),(async()=>{const e=`/.netlify/functions/fetch_air_coords?lat=${t}&long=${o}`;try{const t=await fetch(e);if(t.ok){const e=await t.json();return console.log(e),e}}catch(e){console.log(e)}})().then((e=>l(e))).then((e=>a(e)))},d=e=>{console.warn(`ERROR(${e.code}): ${e.message}`),document.getElementById("error").style.display="block",document.getElementById("error").textContent="Geolocation denied"},i={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};document.getElementById("button").addEventListener("click",c),document.getElementById("getloc").addEventListener("click",(()=>{n(),navigator.geolocation.getCurrentPosition(r,d,i)})),document.getElementById("input-city").addEventListener("keyup",(function(e){"Enter"===e.key&&c()}))})();